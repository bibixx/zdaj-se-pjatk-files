;MIROS£AW DABROWSKI, EWA KOBAYASHI
.ORG 0;
	JP START;

	.ORG 08H;	ODCZYT Z PIO
	JP PIO;

	.ORG 28H;	SIO
	JP SIO;

	.ORG 38H;	REQ
	JP INTREQ;

START:	
	LD SP,7FFFH;
	CALL PIO_INIT;
	CALL SIO_INIT;
	EI

LOOP:	
	JP LOOP;

PIO:
	CALL PIO_IN;	PODPUNKT 3
	LD C,A;
	CALL SIO_OUT;	
	EI
	RET

SIO:
	IN A,(00H);	PODPUNKT 1
	OUT (10H),A;
	EI
	RET

INTREQ:
	IN A,(10H);
	LD C,A;
	CALL SIO_OUT;
	EI
	RET

SIO_INIT:
	LD A,10001010B;	
	OUT (03H),A;	
	LD A,06H;		//SZYBKOSC TRANSMISJI
	OUT (00H),A;	//MNIEJ ZNACZACY BIT DZIELNIKA
	LD A,00H;
	OUT (01H),A;	//BARDZIEJ ZNACZACY BIT DZIELNIKA
	LD A,00001010B;
	OUT (03H),A;	
	LD A,01H;
	OUT (01H),A;
	RET

PIO_INIT:	
	LD A,0BCH;
	OUT (0BH),A;
	LD A,09H;
	OUT (0BH),A;
	RET

SIO_IN:
	IN A,(05H);	
	BIT 0,A;
	JP Z,SIO_IN;
	LD A,(0);
	RET

SIO_OUT:
	IN A,(05H);
	BIT 5,A;
	JP Z,SIO_OUT;
	LD A,C;
	OUT (00H),A;
	RET

PIO_IN:
	IN A,(0AH);
	BIT 3,A;
	JP Z,PIO_IN;
	IN A,(08H);
	RET			
.END
