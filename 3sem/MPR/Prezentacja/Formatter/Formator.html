<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
  <meta name="author" content="Krzysztof Barteczko">
  <meta name="description" content="Podstawy programowania w jêzyku Java (PRG1, PPJ)">
  <meta name="copyright" content="(c) Krzysztof Barteczko PJWSTK 2008">
  <link rel="stylesheet" type="text/css" href="../STYLE/common.css">   
  <title>Przetwarzanie danych: liczby, daty, algorytmy</title></head>

<body>
<div align="center">
<a name="LiczbAlg"></a><h1>Formator</h1>
<hr>
</div>

<h2>1.  Formatowanie liczb i dat</h2>
<br><br><a name="ind.LiczbAlg.20"></a>
Klasa java.utill.Formatter zapewnia mo¿liwoœci formatowania danych.<br>
<br>Tworz¹c formator (za pomoc¹ wywo³ania konstruktora) mo¿emy
okreœliæ: <br>
<br><ul><li>destynacjê formatowanych danych (dok¹d maj¹ byæ zapisane), któr¹ m.in.
mo¿e byæ String, StringBuffer, plik tekstowy,</li></ul><ul><li>lokalizacjê
(ustawienia regionalne, reprezentowane przez obiekt
klasyLocale),&nbsp;wp³ywaj¹c¹ &nbsp;m.in. na reprezentacjê liczb i dat,</li></ul><ul><li>stronê kodow¹ (do kodowania napisów) -
m.in. dla plików i Stringów</li></ul>&nbsp;<br>
Uwaga: formatory dla plików powinny byæ po u¿yciu zamykane lub wymiatane
(close(), flush()),
co powoduje zamkniêcie lub wymiecenie buforów tych destynacji.<br>
<br>
Formatowanie polega na wywo³aniu jednej z dwóch wersji metody format
(na rzecz fornatora):<br> <span style="font-weight: bold;"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;<span style="font-weight: bold;">Formatter
format(String format, Object... arg)</span> <br><span style="font-weight: bold;">&nbsp;Formatter
format(Locale l, String format, Object... arg)&nbsp;</span><br> <br>Druga z tych metod pozwala na podanie lokalizacji, m.in. wp³ywaj¹cej na sposób formatowania liczb.<br><br><a name="ind.LiczbAlg.21"></a>£añcuch formatu (zmienna format) zawiera dowolne ci¹gi znaków oraz specjalne elementy
formatuj¹ce.
Dalej nastêpuj¹ dane do "wstawienia"
w ³añcuch formatu
w miejsce elementów&nbsp;formatu i do sformatowania pod³ug zasad okreœlanych przez te elementy
(zmienna
liczba argumentów dowolnego typu - formalnie Object). Dziêki
autoboxingowi
nie ma problemu z formatowaniem danych typów prostych.<br> <br>Dla uproszczenia dostêpne s¹:
<ul><li>statyczne metody <b>format</b> w
klasie String, pozwalaj¹ce na uzyskiwanie sformatowanych napisów,</li><li>metody <b>format i printf</b>
(dzia³aj¹ce tak samo) w klasach PrintStream i PrintWriter,
wyprowadzaj¹ce sformatowane napisy "na wyjœcie" (np. na standardowe
wyjœcie lub do pliku).</li></ul><div class="syntax">Elementy formatu maj¹ nastêpuj¹c¹ ogóln¹ postaæ:<br><br>%[arg_ind$][flagi][szerokoœæ_pola][.precyzja]konwersja<br><br>gdzie:<br><ul><li>arg_ind$&nbsp;
- numer argumentu (z listy argumentów arg) do sformatowania przez dany
element; numeracja zaczyna siê&nbsp;od 1; poczynaj¹c od drugiego
elmentu formatu mo¿na w tym miejscu zastosowaæ znak &lt; , co oznacza,
¿e dany element ma byæ zastosowany wobec argumentu uzytego w poprzednim
formatowaniu,&nbsp; &nbsp;</li><li>flagi&nbsp; - znaki modyfikuj¹ce sposób formatowania (s¹ ró¿ne dla ró¿nych typów konwersji),</li><li>szerokoœæ_pola - minimalna liczba znaków dla danego argumentu w wynikowym napisie,&nbsp;</li><li>.precyzja
- liczba pokazywanych miejsc dziesiêtnych (dotyczy liczb rzeczywistych)
lub maksymalna&nbsp;liczba wyprowadzanych znaków (dotyczy np. napisów),</li><li>konwersja
- okreœla jak ma byæ traktowany i formatowany odpowiadaj¹cy danemu
elementowi argument - np. jako liczba rzeczywista albo jako napis albo
jako data.<br></li></ul>Uwaga: nawiasy kwadratowe oznaczaj¹ opcjonalnoœæ.<br></div><br><a name="ind.LiczbAlg.22"></a>Symboli konwersji jest b. du¿o, dla ró¿nych symboli mog¹ byæ stosowane te¿ dodatkowe flagi.<br>Wszystko to jest opisane w sposób systematyczny w dokumentacji (proszê siêgaæ). <br>Tutaj przedstawione zostan¹ wybrane konwersje i flagi.<br><br><div style="text-align: center;"><span style="font-weight: bold;">Wybrane konwersje - skrót</span><br></div><table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2"><tbody><tr><td style="text-align: center; font-weight: bold;">Konwersja</td><td style="text-align: center; font-weight: bold;">Mo¿e byæ stosowana wobec</td><td style="text-align: center; font-weight: bold;">Wynik</td></tr><tr><td style="text-align: center; font-weight: bold;">s lub S</td><td>dowolnych danych</td><td>Je¿eli argument jest null - napis "null":<br>w przeciwym razie<br>&nbsp; &nbsp;je¿eli klasa arg na to zezwala <br>&nbsp; &nbsp; &nbsp;- wynik wywo³ania arg.formatTo(...)<br>&nbsp; &nbsp;w przeciwnym razie wynik wywo³ania arg.toString() <br>Uwaga: u¿ycie jako symbolu konwersji du¿ego S spowoduje zamianê liter napisu na du¿e.</td></tr><tr><td style="text-align: center; font-weight: bold;">c lub C</td><td>typów reprezentuj¹cych znaki Unicode</td><td>znak Unicode</td></tr><tr><td style="text-align: center; font-weight: bold;">d</td><td>typów reprezentuj¹cych liczby ca³kowite</td><td>liczba ca³kowita (dziesiêtna)</td></tr><tr><td style="text-align: center; font-weight: bold;">f</td><td>float,&nbsp; double, Float, Double, BigDecimal</td><td>liczba rzeczywista z separatorem miejsc dzisiêtnych</td></tr><tr><td style="text-align: center; font-weight: bold;">tH</td><td colspan="1" rowspan="9">danych reprezentuj¹cych czas, czyli: <br>long, Long, Calendar, Date</td><td>godzina na zegarze 24-godzinnym-2 cyfry (00-23) </td></tr><tr><td style="text-align: center; font-weight: bold;">tM</td><td>minuty - 2 cyfry (00 - 59)</td></tr><tr><td style="text-align: center; font-weight: bold;">tS</td><td>sekundy&nbsp; - 2 cyfry (00-60)</td></tr><tr><td style="text-align: center; font-weight: bold;">tY</td><td>rok - 4 cyfry (np. 2008)</td></tr><tr><td style="text-align: center; font-weight: bold;">tm</td><td>miesi¹c - 2 cyfry (01-12)</td></tr><tr><td style="text-align: center; font-weight: bold;">td</td><td>dzieñ miesi¹ca - 2 cyfry (01 -31)</td></tr><tr><td style="text-align: center; font-weight: bold;">tR</td><td>czas na zegarze 24 godzinnym sformatowany jako&nbsp; "%tH:%tM"</td></tr><tr><td style="text-align: center; font-weight: bold;">tT</td><td>czas na zegarze 24 godzinnym sformatowany jako&nbsp; "%tH:%tM:%tS"</td></tr><tr><td style="text-align: center; font-weight: bold;">tF</td><td>data sformatowana jako "%tY-%tm-%td"</td></tr></tbody></table><br>Wœród flag na szczególn¹ uwagê zas³uguj¹:<br>'-' - wynik wyrównany w polu do lewej (domyslnie jest wyrównany do prawej),<br>'+' - wynik zawiera zawsze znak (dla typów liczbowych),<br>' ' - wynik zawiera wiod¹ca spacjê dla argumentów nieujmenych (tylko dla typów liczbowych).<br><br>Zatem,
aby uzyskaæ sformatowane wyniki w poprzednim przyk³adowym programie
(liczbê z dwoma miejscami dziesiêtnymi, datê w postaci
rok-miesi¹c-dzieñ) mo¿emy napisaæ:<br><pre>import java.util.*;

public class Format1 {

  public static void main(String[] args) {
    double cena = 1.52;
    double ilosc = 3;
    double koszt = cena * ilosc;
    System.out.printf("Koszt wynosi %.2f z³", koszt);
    System.out.printf("\nData: %tF", Calendar.getInstance());
  }

}</pre>Wynik:<br><div class="listing100">Koszt wynosi 4,56 z³<br>Data: 2008-08-14</div><br>Warto
tu zwróciæ uwagê na to, ¿e dla lokalizacji polskiej liczba pokazywana
jest z przecinkiem jako separatorem miejsc dziesiêtnych.<br>Aby uzyskac kropkê mo¿na napisaæ:<br><pre>System.out.printf(Locale.ROOT, "Koszt wynosi %.2f z³", koszt);</pre>W tym przypadku sta³a statyczna Locale.ROOT oznacza neutraln¹ lokalizacjê (bez wybranego kraju i jêzyka).<br><br>Kilka innych przyk³adów pokazuje program na wydruku.<br><pre>import javax.swing.*;

public class Format2 {

  public static void main(String[] args) {
    System.out.println("Wyrównany wydruk tablicy (po 2 elementy w wierszu)");
    int[] arr = { 1, 100, 200, 4000 };
    int k = 1;
    for (int i : arr) {
      System.out.printf("%5d", i);
      if (k%2 ==0) System.out.println();
      k++;
    }
    // Zastosowanie znaku &lt; (element formatu stosowany wobec argumentu z poprzedniego formatowania)
    System.out.println("Zaokraglenia");
    System.out.printf("%.3f %&lt;.2f %&lt;.1f", 1.256 );
    
    // Znak &lt; szczególnie przydatny w datach/czasie
    Calendar c = Calendar.getInstance();
    c.set(Calendar.MONTH, 1);
    System.out.printf("\nW roku %tY i miesi¹cu %&lt;tm mamy %d dni", c, c.getActualMaximum(Calendar.DATE) );
    
    // Oczywiœcie mo¿emy formatowaæ do Stringów
    String dateNow = String.format("%td-%&lt;tm-%&lt;tY", System.currentTimeMillis());
    JOptionPane.showMessageDialog(null, dateNow);
  }

}</pre>Wynik dzia³ania programu (konsolê i okno dialogowe) pokazuje rysunek.<br><img style="border: 2px solid ; width: 584px; height: 162px;" alt="r" src="images/format.jpg"><br><br><hr style="width: 100%; height: 2px;"><br><h2>2. Interfejs Formattable</h2>Dla
symbolu konwersji s lub S je¿eli klasa drugiego argumentu metody format
na to pozwala, to do formatowania zostanie u¿yta metoda formatTo.<br>Jest
to mo¿liwe tylko wtedy gdy klasa argumentu "do sformatowania"
implementuje interfejs Formattable i definiuje jego&nbsp;jedyn¹ metodê:<br><br><div class="syntax">public void formatTo(Formatter formatter, int flags, int width, int precision)</div><br>Jeœli teraz za pomoc¹ jakiegoœ formatora nastêpuje formatowanie obiektu z u¿yciem symbolu konwersji s lub S, to:<br><ol><li>wywo³ywana jest metoda formatTo z klasy obiektu,</li><li>metodzie formatTo jest przekazywany formator (jako parametr <span style="font-style: italic;">formatter</span>), flagi formatowania (parametr <span style="font-style: italic;">flags</span>), szerokoœæ pola (parametr <span style="font-style: italic;">width</span>) i precyzja (parametr <span style="font-style: italic;">precision</span>),</li><li>w
metodzie formatTo mo¿emy sprawdziæ wartoœci przekazanych informacji
(np. locale formatora, flagi, szerokoœæ precyzje) i na tej podstawie
podj¹æ odpowiednie dzia³ania przetwarzaj¹ce obiekt do
wynikowego napisu, </li><li>przed zwróceniem sterowania z metody formatTo wywo³ujemy metodê format przekazanego formatora,</li><li>sformatowany napis bêdzie przez formator zapisany do odpowiedniej destynacji (np. wyprowadzony na standardowe wyjœcie).</li></ol>Sprawdziæ
jakich u¿yto flag formatowania mo¿emy za pomoc¹ porównywania ze sta³ymi
statycznymi klasy java.util.FormattableFlags. Dostêpne s¹ sta³e o
nastêpuj¹cych nazwach:<br><ul><li>ALTERNATE - oznacza, ¿e nale¿y u¿yæ alternatywnej formy sformatowania obiektu (w formacie u¿yto znaku #),</li><li>LEFT_JUSTIFY - sformatowany napis bêdzie wyrównany w polu do lewej (w formacie u¿yto znaku -),</li><li>UPPERCASE - zamiana liter na du¿e (u¿yto wielkiej litery w symbolu konwersji np. S, zamiast s).</li></ul><br>Przyk³adowy
program pokazuje zastosowanie metody formatTo do ³atwej zmiany sposobu
wyprowadzania informacji o obiektach klasy Person. &nbsp;W trybie
normalnym wyprowadzane jest nazwisko, w trybie&nbsp;alternatywnym
(zastosowana flaga #) - nazwisko i imiê. W metodzie formatTo, na
podstawie przekazanych informacji wybieramy formê formatowania,i
budujemy napis formatu na podstawie przekazanej informacji, po czym za
jego pomoc¹ formatujemmy obiekt, u¿ywaj¹c przekazanego formatora. <br><br><pre>import java.util.*;
import static java.util.FormattableFlags.*;

public class Person implements Formattable{
  
  private String fname;
  private String lname;

  public Person(String fname, String lname) {
    this.fname = fname;
    this.lname = lname;
  }

  @Override
  public void formatTo(Formatter formatter, int flags, int width, int precision) {
    String txt = lname;
    if ((flags &amp; ALTERNATE) == ALTERNATE) txt += ' ' + fname;
    String fs = "%";
    if ((flags &amp; LEFT_JUSTIFY) == LEFT_JUSTIFY) fs += '-';
    if (width &gt;= 0) fs += width;
    if (precision &gt;= 0) fs += "."+precision;
    fs += ((flags &amp; UPPERCASE) == UPPERCASE) ?  "S" : "s";
    formatter.format(fs, txt);
  }


  public static void main(String[] args) {
    Person e =  new Person("Jan", "Kowalski");
    System.out.printf("%#s\n", e);
    System.out.printf("%20s\n", e);
    System.out.printf("%#30S\n", e);
    System.out.printf("%#.10S\n", e);
  }

}
</pre>Wynik dzia³ania programu:<br><div class="listing100">Kowalski Jan<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Kowalski<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KOWALSKI JAN<br>KOWALSKI J</div><br><hr style="width: 100%; height: 2px;">
</body></html>